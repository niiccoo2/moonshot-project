<!DOCTYPE html>
<html>
<head>
  <title>Catch Game Input</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" width="300" height="220" style="display:none"></canvas>

<div id="output">
    <div id="left-hand">
        <h3>Left Hand</h3>
        <p>Fingers: <span id="left-fingers">-</span></p>
        <p>Gesture: <span id="left-gesture">-</span></p>
        <p>Wrist X: <span id="left-wrist-x">-</span></p>
        <p>Wrist Y: <span id="left-wrist-y">-</span></p>
    </div>
    <div id="right-hand">
        <h3>Right Hand</h3>
        <p>Fingers: <span id="right-fingers">-</span></p>
        <p>Gesture: <span id="right-gesture">-</span></p>
        <p>Wrist X: <span id="right-wrist-x">-</span></p>
        <p>Wrist Y: <span id="right-wrist-y">-</span></p>
    </div>
    <div id="body">
        <h3>Body:</h3>
        <p>Left Elbow: <span id="left_elbow">-</span></p>
        <p>Right Elbow: <span id="right_elbow">-</span></p>
        <p>Left Shoulder: <span id="left_shoulder">-</span></p>
        <p>Right Shoulder: <span id="right_shoulder">-</span></p>
    </div>

</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const socket = io();

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => video.srcObject = stream);

setInterval(() => {
    ctx.drawImage(video, 0, 0, 320, 240);
    canvas.toBlob(blob => {
        socket.emit("frame", blob);
    }, "image/jpeg", 0.5);
}, 66); // ~15 fps

socket.on("result", data => {
    console.log(data);

    function updateHand(hand, info) {
        if (info) {
            document.getElementById(`${hand}-fingers`).innerText = info.fingers;
            document.getElementById(`${hand}-gesture`).innerText = info.gesture;
            document.getElementById(`${hand}-wrist-x`).innerText = info.wrist.x.toFixed(2);
            document.getElementById(`${hand}-wrist-y`).innerText = info.wrist.y.toFixed(2);
        } else {
            document.getElementById(`${hand}-fingers`).innerText = "-";
            document.getElementById(`${hand}-gesture`).innerText = "-";
            document.getElementById(`${hand}-wrist-x`).innerText = "-";
            document.getElementById(`${hand}-wrist-y`).innerText = "-";
        }
    }
    function setValue(id, value) {
    document.getElementById(id).innerText =
        value !== null ? value.toFixed(2) : "-";
    }

    function updateBody(info) {
        if (!info) {
            setValue("left_elbow", null);
            setValue("right_elbow", null);
            setValue("left_shoulder", null);
            setValue("right_shoulder", null);
            return;
        }

        setValue(
            "left_elbow",
            info.left_elbow ? info.left_elbow.y : null
        );

        setValue(
            "right_elbow",
            info.right_elbow ? info.right_elbow.y : null
        );

        setValue(
            "left_shoulder",
            info.left_shoulder ? info.left_shoulder.y : null
        );

        setValue(
            "right_shoulder",
            info.right_shoulder ? info.right_shoulder.y : null
        );
    }

    // update the info
    updateHand("left", data.hands.left);
    updateHand("right", data.hands.right);
    updateBody("body", data.body);
});

</script>

</body>
</html>
